<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wald-Suchspiel f√ºr Kinder</title>
  <style>
    :root {
      --bg: #0b3d2e;
      --bg-light: #125943;
      --leaf: #2f8f5b;
      --accent: #ffd166;
      --white: #fff;
      --shadow: rgba(0,0,0,.15);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg);
      color: var(--white);
      height: 100vh;
      display: flex;
      overflow: hidden;
    }

    /* Sidebar / Nav */
    aside {
      width: 290px;
      max-width: 42vw;
      background: linear-gradient(180deg, #0f4b38, #0c3e2f 60%);
      border-right: 1px solid rgba(255,255,255,0.1);
      padding: 18px 16px 16px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 800;
      letter-spacing: .3px;
      font-size: 1.2rem;
    }
    .title .emoji { font-size: 1.6rem; }

    .stat-card {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 10px 24px var(--shadow);
      border-radius: 16px;
      padding: 12px;
    }
    .stat-row { display:flex; align-items:center; justify-content:space-between; gap:10px; margin:4px 0 8px; }
    .stat-row strong { font-size: 0.98rem; }
    .progress { height: 8px; background: rgba(255,255,255,0.12); border-radius: 999px; overflow: hidden; }
    .progress .fill { height: 100%; width: 0; background: var(--accent); transition: width .25s ease; }

    .counts { display:grid; grid-template-columns: 1fr auto; gap: 6px 10px; font-size:.95rem; }
    .counts div small { opacity:.8; }

    .controls { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
    button {
      cursor: pointer;
      border: none;
      padding: 10px 12px;
      border-radius: 12px;
      background: var(--accent);
      color: #2b2b2b;
      font-weight: 700;
      box-shadow: 0 6px 16px rgba(0,0,0,.25);
      transition: transform .05s ease, filter .2s ease;
    }
    button.alt { background: #a5ffd6; }
    button:active { transform: translateY(1px); }

    .legend { display:flex; gap:8px; flex-wrap:wrap; margin-top: 2px; }
    .chip {
      display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
      background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.12); font-size:.92rem;
    }

    /* Spielbereich */
    .game {
      position: relative;
      flex: 1 1 auto;
      overflow: hidden;
    }

    /* Waldhintergrund */
    .forest-bg {
      position:absolute; inset:0;
      background-image: url(images/backgrounds/wald1.jpg)
    }
    /* einfache Silhouetten von B√§umen */
    .trees { position:absolute; inset:0; pointer-events:none; opacity:.25; }
    .trees svg { position:absolute; bottom:-20px; }

    /* Items */
    .item {
      position: absolute;
      font-size: clamp(24px, 3.6vw, 42px);
      line-height: 1;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,.35));
      user-select: none;
      transition: transform .15s ease, opacity .3s ease, filter .2s ease;
      cursor: pointer;
    }
    .item:active { transform: scale(0.95); }
    .item.found { opacity: .45; filter: grayscale(0.2) drop-shadow(0 2px 6px rgba(0,0,0,.25)); }
    .item.ping::after {
      content: ""; position:absolute; inset:-10px; border-radius:999px; border:3px dashed rgba(255,255,255,.9);
      animation: ping 1s ease-out forwards; pointer-events:none;
    }
    @keyframes ping { from { opacity:1; transform:scale(.7);} to { opacity:0; transform:scale(1.4);} }

    /* Hinweisleiste oben */
    .hud {
      position: absolute; left: 0; right: 0; top: 0; display: flex; justify-content: center;
      padding: 10px; pointer-events: none;
    }
    .hud .card { pointer-events: auto; background: rgba(0,0,0,.35); backdrop-filter: blur(4px);
      border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; padding: 8px 12px; font-weight: 600;
    }

    .sr-only {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden;
      clip: rect(0, 0, 1px, 1px); white-space: nowrap; border: 0;
    }

    @media (max-width: 820px) {
      aside { width: 250px; }
      .item { font-size: clamp(24px, 5.2vw, 40px); }
    }
    @media (max-width: 640px) {
      aside { position:absolute; z-index:10; inset: auto 8px 8px 8px; width:auto; max-width: unset; border-radius:16px; }
      body { flex-direction: column; }
    }
  </style>
</head>
<body>
  <aside aria-label="Seitennavigation ‚Äì Fortschritt">
    <div class="title"><span class="emoji">üå≤</span> <span>Wald‚ÄëSuchspiel</span></div>
    <div class="stat-card" id="stat-insekten">
      <div class="stat-row"><strong>Insekten</strong><span id="count-insekten">0 / 0</span></div>
      <div class="progress"><div class="fill" id="bar-insekten"></div></div>
      <div class="counts">
        <div>Gefunden:</div><div id="found-insekten">0</div>
        <div>Fehlen noch:</div><div id="left-insekten">0</div>
      </div>
    </div>
    <div class="stat-card" id="stat-pflanzen">
      <div class="stat-row"><strong>Pflanzen</strong><span id="count-pflanzen">0 / 0</span></div>
      <div class="progress"><div class="fill" id="bar-pflanzen"></div></div>
      <div class="counts">
        <div>Gefunden:</div><div id="found-pflanzen">0</div>
        <div>Fehlen noch:</div><div id="left-pflanzen">0</div>
      </div>
    </div>
    <div class="stat-card" id="stat-tiere">
      <div class="stat-row"><strong>Tiere</strong><span id="count-tiere">0 / 0</span></div>
      <div class="progress"><div class="fill" id="bar-tiere"></div></div>
      <div class="counts">
        <div>Gefunden:</div><div id="found-tiere">0</div>
        <div>Fehlen noch:</div><div id="left-tiere">0</div>
      </div>
    </div>

    <div class="legend">
      <div class="chip">ü¶ã Insekten</div>
      <div class="chip">üåº Pflanzen</div>
      <div class="chip">ü¶ä Tiere</div>
    </div>

    <div class="controls">
      <button id="btn-reshuffle" title="Neu mischen">üîÅ Neu mischen</button>
      <button id="btn-hint" class="alt" title="Tipp anzeigen">üí° Tipp</button>
      <button id="btn-reset" title="Alles zur√ºcksetzen">üßπ Zur√ºcksetzen</button>
    </div>
  </aside>

  <main class="game" id="game" aria-label="Spielbereich ‚Äì Klicke die versteckten Dinge im Wald an">
    <div class="forest-bg"></div>
    <div class="trees" aria-hidden="true">
      <!-- einfache, wiederholte Baum-Silhouetten -->
      <svg width="160" height="140" viewBox="0 0 160 140" fill="none" xmlns="http://www.w3.org/2000/svg" style="left:2%">
        <path d="M80 0 L140 90 H110 L150 130 H10 L50 90 H20 Z" fill="#0a2f23"/>
      </svg>
      <svg width="200" height="160" viewBox="0 0 160 140" fill="none" xmlns="http://www.w3.org/2000/svg" style="left:28%">
        <path d="M80 0 L140 90 H110 L150 130 H10 L50 90 H20 Z" fill="#0a2f23"/>
      </svg>
      <svg width="220" height="160" viewBox="0 0 160 140" fill="none" xmlns="http://www.w3.org/2000/svg" style="left:54%">
        <path d="M80 0 L140 90 H110 L150 130 H10 L50 90 H20 Z" fill="#0a2f23"/>
      </svg>
      <svg width="180" height="160" viewBox="0 0 160 140" fill="none" xmlns="http://www.w3.org/2000/svg" style="left:78%">
        <path d="M80 0 L140 90 H110 L150 130 H10 L50 90 H20 Z" fill="#0a2f23"/>
      </svg>
    </div>

    <div class="hud" aria-live="polite"><div class="card" id="hud-text">Finde alle Insekten, Pflanzen & Tiere!</div></div>
  </main>

  <div class="sr-only" id="sr-status" aria-live="polite"></div>

  <script>
    const CATEGORIES = [
      { key: 'insekten', label: 'Insekten' },
      { key: 'pflanzen', label: 'Pflanzen' },
      { key: 'tiere',    label: 'Tiere' }
    ];

    const MASTER_ITEMS = [
      // Insekten
      { type: 'insekten', label: 'ü¶ã', name: 'Schmetterling' },
      { type: 'insekten', label: 'üêû', name: 'Marienk√§fer' },
      { type: 'insekten', label: 'üêú', name: 'Ameise' },
      { type: 'insekten', label: 'ü™≤', name: 'K√§fer' },
      { type: 'insekten', label: 'üêù', name: 'Biene' },
      // Pflanzen
      { type: 'pflanzen', label: 'üçÑ', name: 'Pilz' },
      { type: 'pflanzen', label: 'üåº', name: 'Blume' },
      { type: 'pflanzen', label: 'üåø', name: 'Farn' },
      { type: 'pflanzen', label: 'üå∑', name: 'Tulpe' },
      { type: 'pflanzen', label: 'üå≤', name: 'Tanne' },
      // Tiere
      { type: 'tiere', label: 'ü¶ä', name: 'Fuchs' },
      { type: 'tiere', label: 'ü¶å', name: 'Hirsch' },
      { type: 'tiere', label: 'ü¶â', name: 'Eule' },
      { type: 'tiere', label: 'üêøÔ∏è', name: 'Eichh√∂rnchen' },
      { type: 'tiere', label: 'üê∞', name: 'Hase' }
    ];

    const gameEl = document.getElementById('game');
    const hudText = document.getElementById('hud-text');
    const srStatus = document.getElementById('sr-status');

    const state = {
      items: [], // will hold placed items with positions & found flag
      totals: { insekten: 0, pflanzen: 0, tiere: 0 },
      found:  { insekten: 0, pflanzen: 0, tiere: 0 },
    };

    // UI Hook helpers
    function setBar(catKey, percent) {
      document.getElementById(`bar-${catKey}`).style.width = `${percent}%`;
    }
    function setCounts(catKey) {
      const total = state.totals[catKey];
      const found = state.found[catKey];
      document.getElementById(`count-${catKey}`).textContent = `${found} / ${total}`;
      document.getElementById(`found-${catKey}`).textContent = found;
      document.getElementById(`left-${catKey}`).textContent = Math.max(0, total - found);
      setBar(catKey, total ? Math.round((found/total)*100) : 0);
    }
    function refreshAllCounts() {
      CATEGORIES.forEach(c => setCounts(c.key));
      const allFound = CATEGORIES.every(c => state.found[c.key] === state.totals[c.key]);
      hudText.textContent = allFound ? 'Hurra! Du hast alles gefunden! üéâ' : 'Finde alle Insekten, Pflanzen & Tiere!';
    }

    // Create grid positions to avoid overlaps (5 columns x 3 rows)
    function buildGridPositions(cols=5, rows=3) {
      const cells = [];
      for (let r=0; r<rows; r++) {
        for (let c=0; c<cols; c++) {
          // padding so items are not too close to the edges
          const xMin = (c   / cols) * 100 + 5;
          const xMax = ((c+1) / cols) * 100 - 5;
          const yMin = (r   / rows) * 100 + 8;
          const yMax = ((r+1) / rows) * 100 - 8;
          cells.push({ xMin, xMax, yMin, yMax });
        }
      }
      return cells;
    }

    function randIn(min, max) { return min + Math.random() * (max - min); }

    function placeItems() {
      // Reset DOM & state
      state.items = [];
      state.totals = { insekten: 0, pflanzen: 0, tiere: 0 };
      state.found  = { insekten: 0, pflanzen: 0, tiere: 0 };
      gameEl.querySelectorAll('.item').forEach(n => n.remove());

      const grid = buildGridPositions(5, 3);
      const cells = shuffle([...grid]).slice(0, MASTER_ITEMS.length);

      MASTER_ITEMS.forEach((baseItem, i) => {
        const cell = cells[i % cells.length];
        const left = randIn(cell.xMin, cell.xMax);
        const top  = randIn(cell.yMin, cell.yMax);
        const item = {
          ...baseItem,
          id: i,
          left, top,
          found: false,
        };
        state.items.push(item);
        state.totals[item.type]++;
        createItemEl(item);
      });

      refreshAllCounts();
    }

    function createItemEl(item) {
      const el = document.createElement('button');
      el.className = 'item';
      el.style.left = item.left + '%';
      el.style.top  = item.top + '%';
      el.setAttribute('aria-label', `${item.name} (${item.type})`);
      el.setAttribute('data-id', item.id);
      el.title = `${item.name} finden`;
      el.textContent = item.label;

      el.addEventListener('click', () => toggleFound(item.id, el));
      gameEl.appendChild(el);
    }

    function toggleFound(id, el) {
      const item = state.items.find(it => it.id === id);
      if (!item) return;
      item.found = !item.found;
      el.classList.toggle('found', item.found);

      const delta = item.found ? 1 : -1;
      state.found[item.type] = Math.max(0, Math.min(state.totals[item.type], state.found[item.type] + delta));
      setCounts(item.type);

      const remaining = state.totals[item.type] - state.found[item.type];
      srStatus.textContent = `${item.name} ${item.found ? 'gefunden' : 'zur√ºckgesetzt'}. ${remaining} ${remaining===1? 'Element fehlt' : 'Elemente fehlen'} bei ${labelOf(item.type)}.`;
      const allFound = CATEGORIES.every(c => state.found[c.key] === state.totals[c.key]);
      if (allFound) celebrate();
    }

    function labelOf(key){ return CATEGORIES.find(c=>c.key===key)?.label || key; }

    function celebrate(){
      hudText.textContent = 'Hurra! Du hast alles gefunden! üéâ';
      // kleines Konfetti (reines CSS/JS, kein externes Asset)
      for (let i=0;i<14;i++) {
        const conf = document.createElement('div');
        conf.style.position = 'absolute';
        conf.style.left = Math.random()*100 + '%';
        conf.style.top  = '-10px';
        conf.style.width = conf.style.height = '8px';
        conf.style.background = 'hsl(' + Math.floor(Math.random()*360) + 'deg 90% 60%)';
        conf.style.borderRadius = '2px';
        conf.style.opacity = '0.9';
        conf.style.transform = 'translateY(0)';
        conf.style.transition = 'transform 1.2s ease-out, opacity 1.2s ease-out';
        conf.style.zIndex = 5;
        gameEl.appendChild(conf);
        requestAnimationFrame(()=>{
          conf.style.transform = 'translateY(110vh) rotate(' + (Math.random()>0.5?'' : '-') + Math.random()*180 + 'deg)';
          conf.style.opacity = '0';
        });
        setTimeout(()=>conf.remove(), 1300);
      }
    }

    function shuffle(arr){ for (let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

    // Controls
    document.getElementById('btn-reshuffle').addEventListener('click', () => {
      placeItems();
      hudText.textContent = 'Neu gemischt! Viel Erfolg!';
    });
    document.getElementById('btn-reset').addEventListener('click', () => {
      state.items.forEach(it => it.found = false);
      gameEl.querySelectorAll('.item').forEach(n => n.classList.remove('found'));
      state.found = { insekten:0, pflanzen:0, tiere:0 };
      refreshAllCounts();
      hudText.textContent = 'Alles zur√ºckgesetzt!';
    });
    document.getElementById('btn-hint').addEventListener('click', () => {
      // kurz alle nicht gefundenen Elemente hervorheben
      gameEl.querySelectorAll('.item').forEach(n => {
        const id = Number(n.getAttribute('data-id'));
        const it = state.items.find(x=>x.id===id);
        if (it && !it.found) {
          n.classList.add('ping');
          setTimeout(()=>n.classList.remove('ping'), 1000);
        }
      });
    });

    // Kickoff
    placeItems();
  </script>
</body>
</html>
